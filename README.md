# QuRi-kinton
QR code generator from scratch

このリポジトリはthonky.comの**QR Code Tutorial**を日本語訳しながらRustで実装するリポジトリです

# 導入
QRコードは数字や文字、漢字のような情報をエンコードできる特殊な形のバーコードです。
このチュートリアルはどのようにQRコードがエンコードされているか知りたいプログラマのために書かれています。
エンコーディングプロセスは複雑です。誤り訂正不符号の生成ステップは特に。

# 歴史
QRコードフォーマットは1994年に日本のデンソーウェーブによって生み出されました。
デンソーウェーブは自動車部品を製造するトヨタの子会社です。
この標準規格は**ISO/IEC18004:2006**に定義されています。
QRコードの使用にライセンスは必要ありません。

一番小さいQRコードのサイズは21x21ピクセルで、一番大きいサイズのQRコードは177x177ピクセルです。
このサイズは**バージョン**と呼ばれます。下記にサイズとバージョンの対応表を記載します。


<details>
<summary> 対応表 </summary>

|サイズ|バージョン|
|---|---|
|21x21|1|
|25x25|2|
|29x29|3|
|33x33|4|
|37x37|5|
|41x41|6|
|45x45|7|
|49x49|8|
|53x53|9|
|57x57|10|
|61x61|11|
|65x65|12|
|69x69|13|
|73x73|14|
|77x77|15|
|81x81|16|
|85x85|17|
|89x89|18|
|93x93|19|
|97x97|20|
|101x101|21|
|105x105|22|
|109x109|23|
|113x113|24|
|117x117|25|
|121x121|26|
|125x125|27|
|129x129|28|
|133x133|29|
|137x137|30|
|141x141|31|
|145x145|32|
|149x149|33|
|153x153|34|
|157x157|35|
|161x161|36|
|165x165|37|
|169x169|38|
|173x173|39|
|177x177|40|
</details>

加えて、QRコードには誤り訂正機能が含まれています。
QRコードをエンコードするとき、QRリーダーが、一部が読み取れないQRコードを正確に読み取る手助けをするための冗長なデータを生成します。
誤り訂正機能には4つのレベルがあり、この中から選択することができます。

|レベル|欠損許容量|
|---|---|
|L|7%|
|M|15%|
|Q|25%|
|H|30%|

与えられたQRコードの容量はバージョンと誤り訂正レベル、そしてエンコードするデータタイプに依存します。
QRコードがエンコードできるデータモードは4つあります。

- 数字(numeric)
- 英数字(alphanumeric)
- 2進数表現データ(binary)
- 漢字(kanji)


# QRコード生成の概要
続くページではQRコードのエンコードプロセスを詳細に説明します。

## 1. データ解析  
QRコードはテキスト文字列をエンコードします。
QRコードの規格ではテキストをエンコードするための4つのモードがあります。(数字、英数字、二進数データ、漢字)
各モードはテキストを0か1で表現された文字列にエンコードします。
しかし、各モードはそれぞれ異なる方法でテキストをビット表現に変換しています。
そしてそれぞれ可能な限り短いビット文字列にエンコードするために最適化されています。
したがって、最初のステップで与えられたテキストがどのモードでエンコードできるのか、
そして最も適したモードを選択するためにデータ解析を行います。

## 2. データエンコード  
ステップ1で最適なエンコードモードを選択したら、次のステップはデータのエンコードです。
このセクションでは各エンコードモードで詳細にエンコードプロセスを説明します。
このセクションの結果は8ビットに分割されたビット文字列です。

## 3. 誤り訂正コーディング  
上述の通り、QRコードには誤り訂正機能があります。
これは入力されたテキストを表すビット文字列を生成した後、
これらのビットを使用して、リードソロモンと呼ばれるプロセスを用いて誤り訂正符号を生成する必要があることを意味します。
QRスキャナーはデータ符号と誤り訂正符号の両方を読み取ります。
この２つを比較することによって、スキャナーはデータが正確に読み取れたかを判定することができます。
データが正確に読み取れない場合には誤りを訂正することができます。
このセクションでは、誤り訂正符号の生成プロセスを詳細に説明します。
より、詳細な情報については下記のWikiを読んでください。
[リード・ソロモン符号](https://ja.wikipedia.org/wiki/%E3%83%AA%E3%83%BC%E3%83%89%E3%83%BB%E3%82%BD%E3%83%AD%E3%83%A2%E3%83%B3%E7%AC%A6%E5%8F%B7)

## 4. Structure Final Message  
データと誤り訂正符号を生成したあとはこれらを適切な順序で配置する必要があります。
大きいQRコードの場合、データと誤り訂正符号はブロックで生成され、
これらのブロックはQRコードの仕様に沿って、インターリーブされている必要があります。
このセクションではこのプロセスについて詳細に説明します。

## 5. モジュールをマトリックスに配置する  
データの生成、誤り訂正符号の生成、これらを適切な順序で配置した後は、
QRコードマトリックスにビットを配置する必要があります。
符号は指定された方法でマトリックスに配置されています。
このステップ中、３つの角に配置された『ボックス』など、全てのQRに共通したパターンも配置します。
このセクションではこのプロセスについて詳細に説明します。

## 6. データマスキング  
QRコードマトリックス中の特定のパターンは、QRコードスキャナーがコードを正確に読み取ることを困難にする可能性があります。これの対策として、QRコードの仕様は『8ビットマスクパターン』を定義しています。
これはそれぞれ特定のパターンに従ってQRコードを変更します。
これらのQRコードのマスクパターンの結果から、最も望ましくない特性の少ないQRコードがどれなのか判定しなければいけません。
これは4つのペナルティルールに基づいて、それぞれのマスクされた行列を評価することによって行われます。
最終的なQRコードは最もペナルティスコアが低いマスクパターンを使用する必要があります。
このセクションではこのプロセスについて詳細に説明します。

## 7. フォーマットとバージョン情報  
最後のステップはQ前のステップでは空白のままだったQRコードの特定のエリアにピクセルを追加して、
フォーマットとバージョン情報(必要であれば)を追加することです。
フォーマットピクセルは誤り訂正レベルとQRコードに使用されているマスクパターンを識別します。
バージョンピクセルはQRマトリックスのサイズと符号化し、より大きいQRコードでのみ使用されます。
このセクションではこのプロセスについて詳細に説明します。

